@model IEnumerable<PlayableChannelModel>
@{
    Layout = null;

    var playerNames = new Dictionary<LyrionCLI.Player, string>();
    foreach (var player in LyrionKnownPlayers.known)
    {
        playerNames.Add(player, await LyrionCLI.Players.getNameAsync(player));
    }
}

<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=0" />
    <title>Channel List</title>
    @await Html.PartialAsync("_Styles")
    <style type="text/css">
        .box {
            border: 1px solid currentColor;
            display: inline-block;
            height: 200px;
            margin: 0.5em;
            overflow-y: scroll;
            vertical-align: top;
            width: 250px;
        }

        summary {
            background-color: steelblue;
            color: white;
            cursor: pointer;
            font-weight: bold;
            padding: 8px 0;
            user-select: none;
        }
    </style>
</head>
<body>
    @foreach (var group in Model.GroupBy(c => c.Category))
    {
        <details>
            <summary>@group.Key</summary>
            @foreach (var channel in group)
            {
                <div class="box">
                    <details>
                        <summary>@channel.Name</summary>

                        <p>
                            <a href="@channel.Url">
                                Play on this device
                            </a>
                            <br>
                            <small>Some devices may not be able to play HLS streams directly.</small>
                        </p>

                        @foreach (var player in LyrionKnownPlayers.known)
                        {
                            <p>
                                <form asp-controller="Player" asp-action="PlayUrl">
                                    <input type="hidden" name="id" value="@player.Item" />
                                    <input type="hidden" name="url" value="@channel.Url" />
                                    <input type="hidden" name="name" value="@channel.Name" />
                                    <button type="submit">
                                        Play on @playerNames[player]
                                    </button>
                                </form>
                            </p>
                        }
                    </details>
                </div>
            }
        </details>
    }
</body>
</html>
